---
interface Props {
  title: string;
  excerpt: string;
  date: string;
  readTime: string;
  category: string;
  author?: string;
  image?: string;
  slug?: string;
  featured?: boolean;
}

const { 
  title, 
  excerpt, 
  date, 
  readTime, 
  category, 
  author = "Alex B. García",
  image,
slug = title.toLowerCase()
    .replace(/ñ/g, 'n')
    .replace(/[áàäâ]/g, 'a')
    .replace(/[éèëê]/g, 'e')
    .replace(/[íìïî]/g, 'i')
    .replace(/[óòöô]/g, 'o')
    .replace(/[úùüû]/g, 'u')
    .replace(/\s+/g, '-'),
  featured = false
} = Astro.props;

// Format date for display
const formatDate = (dateString: string) => {
  const date = new Date(dateString);
  return date.toLocaleDateString('es-ES', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
};
---

<article class={`group ${featured ? 'featured-post' : ''}`}>
  <a href={`/blog/${slug}`} class="block rounded-2xl overflow-hidden hover:shadow-lg transition-all duration-300">
    {image && (
      <div class="relative h-48 overflow-hidden">
        <img
          src={image}
          alt={title}
          class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
        />
        {featured && (
          <span class="absolute top-4 right-4 bg-blue-600 text-white px-3 py-1 rounded-full text-xs font-medium">
            Destacado
          </span>
        )}
      </div>
    )}
    
    <div class={`p-4 sm:p-6 ${image ? 'bg-white' : 'bg-blue-50/50 hover:bg-blue-50/80'} transition-colors`}>
      <!-- Category and Meta Info -->
      <div class="flex flex-col md:flex-row md:items-center justify-between gap-2 mb-3">
        <span class="px-3 py-1 bg-blue-100 text-blue-600 rounded-full text-xs font-medium w-fit">
          {category}
        </span>
        <div class="flex items-center gap-2 text-blue-400 text-sm">
          <time datetime={date}>{formatDate(date)}</time>
          <span>•</span>
          <span>{readTime} lectura</span>
        </div>
      </div>

      <!-- Title -->
      <h3 class="text-lg sm:text-xl font-medium text-blue-900 mb-2 group-hover:text-blue-600 transition-colors line-clamp-2">
        {title}
      </h3>

      <!-- Excerpt -->
      <p class="text-blue-600/80 text-sm sm:text-base mb-4 line-clamp-3">
        {excerpt}
      </p>

      <!-- Author -->
      {author && (
        <div class="flex items-center gap-2 text-blue-500 text-sm">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4">
            <path fill-rule="evenodd" d="M18.685 19.097A9.723 9.723 0 0021.75 12c0-5.385-4.365-9.75-9.75-9.75S2.25 6.615 2.25 12a9.723 9.723 0 003.065 7.097A9.716 9.716 0 0012 21.75a9.716 9.716 0 006.685-2.653zm-12.54-1.285A7.486 7.486 0 0112 15a7.486 7.486 0 015.855 2.812A8.224 8.224 0 0112 20.25a8.224 8.224 0 01-5.855-2.438zM15.75 9a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" clip-rule="evenodd" />
          </svg>
          <span>Por {author}</span>
        </div>
      )}

      <!-- Read More Link -->
      <div class="mt-4 pt-3 border-t border-blue-100">
        <span class="text-blue-600 hover:text-blue-800 text-sm font-medium group-hover:underline">
          Leer más →
        </span>
      </div>
    </div>
  </a>
</article>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .featured-post {
    @apply ring-2 ring-blue-200 ring-opacity-50;
  }
</style>
